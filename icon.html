<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Извлечение иконки из apk файла онлайн</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  :root {
    --bg: #ffffff;
    --fg: #000000;
    --border: #000000;
    --muted: #555555;
    --hover-bg: #000000;
    --hover-fg: #ffffff;
    --card-bg: #f5f5f5;
    --shadow: rgba(0,0,0,0.15);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0a0a0a;
      --fg: #ffffff;
      --border: #ffffff;
      --muted: #aaaaaa;
      --hover-bg: #ffffff;
      --hover-fg: #000000;
      --card-bg: #1a1a1a;
      --shadow: rgba(255,255,255,0.1);
    }
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--fg);
    font-family: Georgia, 'Times New Roman', serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 60px 20px;
  }

  header {
    text-align: center;
    margin-bottom: 60px;
  }

  h1 {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 400;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border-bottom: 2px solid var(--fg);
    padding-bottom: 16px;
    margin-bottom: 12px;
  }

  .subtitle {
    color: var(--muted);
    font-size: 0.95rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .drop-zone {
    width: 100%;
    max-width: 560px;
    border: 2px solid var(--border);
    padding: 60px 40px;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
    position: relative;
    margin-bottom: 40px;
  }

  .drop-zone:hover, .drop-zone.dragover {
    background: var(--hover-bg);
    color: var(--hover-fg);
  }

  .drop-zone:hover .drop-icon, .drop-zone.dragover .drop-icon {
    border-color: var(--hover-fg);
    color: var(--hover-fg);
  }

  .drop-icon {
    width: 64px;
    height: 64px;
    border: 2px solid var(--fg);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    font-size: 1.6rem;
    transition: border-color 0.2s, color 0.2s;
  }

  .drop-label {
    font-size: 1.1rem;
    letter-spacing: 0.05em;
    margin-bottom: 8px;
  }

  .drop-sub {
    font-size: 0.8rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .drop-zone.dragover .drop-sub {
    color: var(--hover-fg);
    opacity: 0.7;
  }

  #fileInput { display: none; }

  #status {
    max-width: 560px;
    width: 100%;
    text-align: center;
    min-height: 24px;
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 40px;
  }

  .progress-bar-wrap {
    width: 100%;
    max-width: 560px;
    height: 2px;
    background: var(--card-bg);
    margin-bottom: 40px;
    display: none;
  }

  .progress-bar {
    height: 100%;
    background: var(--fg);
    width: 0%;
    transition: width 0.3s;
  }

  #results {
    width: 100%;
    max-width: 900px;
    display: none;
  }

  .results-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    border-bottom: 1px solid var(--border);
    padding-bottom: 12px;
    margin-bottom: 32px;
  }

  .results-title {
    font-size: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .results-count {
    font-size: 0.8rem;
    color: var(--muted);
    letter-spacing: 0.08em;
  }

  .icons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
  }

  .icon-card {
    border: 1px solid var(--border);
    padding: 24px 16px 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    background: var(--card-bg);
  }

  .icon-card img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    image-rendering: pixelated;
  }

  .icon-name {
    font-size: 0.7rem;
    color: var(--muted);
    text-align: center;
    word-break: break-all;
    letter-spacing: 0.04em;
    line-height: 1.4;
  }

  .icon-size {
    font-size: 0.75rem;
    color: var(--fg);
    letter-spacing: 0.06em;
  }

  .btn-download {
    width: 100%;
    background: transparent;
    color: var(--fg);
    border: 1px solid var(--border);
    padding: 7px 12px;
    font-family: inherit;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }

  .btn-download:hover {
    background: var(--hover-bg);
    color: var(--hover-fg);
  }

  .btn-download-all {
    display: block;
    width: 100%;
    max-width: 560px;
    margin: 0 auto;
    background: var(--fg);
    color: var(--bg);
    border: 2px solid var(--border);
    padding: 16px 32px;
    font-family: inherit;
    font-size: 0.85rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }

  .btn-download-all:hover {
    background: var(--bg);
    color: var(--fg);
  }

  .error-msg {
    color: var(--fg);
    font-size: 0.85rem;
    letter-spacing: 0.06em;
    border: 1px solid var(--border);
    padding: 12px 20px;
    max-width: 560px;
    margin: 0 auto;
  }
</style>
</head>
<body>

<header>
  <h1>Извлечение иконки из apk файла</h1>
  <p class="subtitle">Извлечение иконок из APK файлов</p>
</header>

<div class="drop-zone" id="dropZone">
  <div class="drop-icon">↑</div>
  <p class="drop-label">Перетащите APK файл сюда</p>
  <p class="drop-sub">или нажмите для выбора</p>
</div>
<input type="file" id="fileInput" accept=".apk">

<div class="progress-bar-wrap" id="progressWrap">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div id="status"></div>

<div id="results">
  <div class="results-header">
    <span class="results-title">Найденные иконки</span>
    <span class="results-count" id="resultsCount"></span>
  </div>
  <div class="icons-grid" id="iconsGrid"></div>
  <button class="btn-download-all" id="btnDownloadAll">Скачать все иконки</button>
</div>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const status = document.getElementById('status');
const results = document.getElementById('results');
const iconsGrid = document.getElementById('iconsGrid');
const resultsCount = document.getElementById('resultsCount');
const progressWrap = document.getElementById('progressWrap');
const progressBar = document.getElementById('progressBar');
const btnDownloadAll = document.getElementById('btnDownloadAll');

let extractedIcons = [];

dropZone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', e => { if (e.target.files[0]) processFile(e.target.files[0]); });

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file) processFile(file);
});

function setStatus(msg) { status.textContent = msg; }
function setProgress(val) {
  progressWrap.style.display = 'block';
  progressBar.style.width = val + '%';
  if (val >= 100) setTimeout(() => { progressWrap.style.display = 'none'; progressBar.style.width = '0%'; }, 500);
}

async function processFile(file) {
  if (!file.name.endsWith('.apk')) {
    setStatus('Ошибка: выберите файл с расширением .apk');
    return;
  }

  extractedIcons = [];
  iconsGrid.innerHTML = '';
  results.style.display = 'none';
  setStatus('Чтение файла...');
  setProgress(10);

  try {
    const arrayBuffer = await file.arrayBuffer();
    setProgress(30);
    setStatus('Распаковка APK...');

    const zip = await JSZip.loadAsync(arrayBuffer);
    setProgress(60);
    setStatus('Поиск иконок...');

    const iconPaths = [];
    const iconPatterns = [
      /res\/mipmap[^/]*\/ic_launcher[^/]*\.(png|webp)$/i,
      /res\/drawable[^/]*\/ic_launcher[^/]*\.(png|webp)$/i,
      /res\/mipmap[^/]*\/[^/]*icon[^/]*\.(png|webp)$/i,
      /res\/drawable[^/]*\/[^/]*icon[^/]*\.(png|webp)$/i,
    ];

    zip.forEach((relativePath, zipEntry) => {
      if (zipEntry.dir) return;
      const match = iconPatterns.some(p => p.test(relativePath));
      if (match) iconPaths.push({ path: relativePath, entry: zipEntry });
    });

    // Fallback: all png/webp in res/
    if (iconPaths.length === 0) {
      zip.forEach((relativePath, zipEntry) => {
        if (zipEntry.dir) return;
        if (/^res\/.+\.(png|webp)$/i.test(relativePath)) {
          iconPaths.push({ path: relativePath, entry: zipEntry });
        }
      });
    }

    setProgress(75);

    if (iconPaths.length === 0) {
      setStatus('Иконки не найдены в данном APK файле.');
      setProgress(100);
      return;
    }

    setStatus(`Извлечение ${iconPaths.length} иконок...`);

    for (let i = 0; i < iconPaths.length; i++) {
      const { path, entry } = iconPaths[i];
      try {
        const blob = await entry.async('blob');
        const url = URL.createObjectURL(blob);
        const parts = path.split('/');
        const filename = parts[parts.length - 1];
        const folder = parts.slice(0, -1).join('/');
        extractedIcons.push({ url, filename, folder, blob, path });
        renderIcon({ url, filename, folder, path }, i);
      } catch(e) { /* skip unreadable */ }
      setProgress(75 + (i / iconPaths.length) * 20);
    }

    // Sort: larger resolution folders first
    const order = ['xxxhdpi','xxhdpi','xhdpi','hdpi','mdpi','ldpi'];
    extractedIcons.sort((a, b) => {
      const ai = order.findIndex(o => a.folder.includes(o));
      const bi = order.findIndex(o => b.folder.includes(o));
      return (ai === -1 ? 99 : ai) - (bi === -1 ? 99 : bi);
    });

    iconsGrid.innerHTML = '';
    extractedIcons.forEach((icon, i) => renderIcon(icon, i));

    results.style.display = 'block';
    resultsCount.textContent = extractedIcons.length + ' шт.';
    setStatus('');
    setProgress(100);
  } catch (err) {
    setStatus('Ошибка при обработке файла: ' + err.message);
    setProgress(100);
  }
}

function renderIcon(icon, index) {
  const card = document.createElement('div');
  card.className = 'icon-card';

  const img = document.createElement('img');
  img.src = icon.url;
  img.alt = icon.filename;

  const name = document.createElement('div');
  name.className = 'icon-name';
  name.textContent = icon.path.replace('res/', '');

  const sizeWrap = document.createElement('div');
  sizeWrap.className = 'icon-size';
  img.onload = () => {
    sizeWrap.textContent = img.naturalWidth + '×' + img.naturalHeight;
  };

  const btn = document.createElement('button');
  btn.className = 'btn-download';
  btn.textContent = 'Скачать';
  btn.addEventListener('click', () => downloadFile(icon.blob, icon.filename));

  card.append(img, name, sizeWrap, btn);
  iconsGrid.appendChild(card);
}

function downloadFile(blob, filename) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

btnDownloadAll.addEventListener('click', async () => {
  if (extractedIcons.length === 0) return;
  btnDownloadAll.textContent = 'Упаковка...';
  btnDownloadAll.disabled = true;

  const zip = new JSZip();
  for (const icon of extractedIcons) {
    zip.file(icon.path.replace(/^res\//, ''), icon.blob);
  }
  const content = await zip.generateAsync({ type: 'blob' });
  downloadFile(content, 'apk_icons.zip');

  btnDownloadAll.textContent = 'Скачать все иконки';
  btnDownloadAll.disabled = false;
});
</script>
</body>
</html>
